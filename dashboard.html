<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cycle Ride üö≤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --yellow:#FFD400;
  --black:#0a0a0a;
  --card:#111;
  --text:#f5f5f5;
  --muted:#9ca3af;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:var(--black);color:var(--text);min-height:100vh;}

@keyframes slideUp{
  from{transform:translateY(40px);opacity:0}
  to{transform:translateY(0);opacity:1}
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 30px;
  color:var(--yellow);
  font-size:1.8rem;
  font-weight:700;
}

#aboutBtn{
  background:none;
  border:1px solid var(--yellow);
  color:var(--yellow);
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
}
#aboutBtn:hover{background:var(--yellow);color:black}

/* MAIN */
main{
  max-width:1100px;
  margin:auto;
  padding:20px;
  animation:slideUp .6s ease;
}

/* TOP BAR */
#topBar{
  background:#111;
  border-radius:14px;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
.logout{
  background:red;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  color:white;
  cursor:pointer;
}

/* CARDS */
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  display:flex;
  gap:16px;
  align-items:center;
  margin-bottom:16px;
  box-shadow:0 0 0 rgba(255,212,0,0);
  transition:.3s;
}
.card:hover{box-shadow:0 0 20px rgba(255,212,0,.4)}

.card img{
  width:130px;
  height:90px;
  object-fit:cover;
  border-radius:12px;
}

.info{flex:1}
.info b{font-size:1.1rem}
.muted{color:var(--muted);font-size:.9rem}

/* BUTTONS */
button{
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}
.rentBtn{background:var(--yellow);color:black}
.returnBtn{background:orange}
.deleteBtn{background:red;color:white}

/* ADMIN */
#adminPanel{
  margin-top:40px;
  background:#111;
  padding:24px;
  border-radius:20px;
}
.adminForm{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
  margin-bottom:20px;
}
.adminForm input{
  padding:12px;
  border-radius:12px;
  border:1px solid #333;
  background:#000;
  color:white;
}
.addBtn{background:var(--yellow);color:black}

/* TABLE */
table{width:100%;border-collapse:collapse;border-radius:12px;overflow:hidden}
th,td{padding:12px;text-align:center}
th{background:var(--yellow);color:black}
tr:nth-child(even){background:#1a1a1a}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  z-index:100;
}
.modal-content{
  background:#111;
  margin:10% auto;
  padding:20px;
  border-radius:16px;
  width:90%;
  max-width:500px;
}
.close{
  color:var(--yellow);
  float:right;
  font-size:28px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div>Cycle Ride üö≤</div>
  <button id="aboutBtn">About Us</button>
</header>

<main>
  <div id="topBar">
    <span id="userName"></span>
    <button class="logout" id="logoutBtn">Logout</button>
  </div>

  <h2 style="margin-bottom:14px;">Available Cycles</h2>
  <div id="cycleList"></div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" style="display:none;">
    <h2>Admin Panel</h2>

    <div class="adminForm">
      <input id="ownerName" placeholder="Owner name">
      <input id="price" type="number" placeholder="Price per day">
      <input id="campus" placeholder="Campus">
      <input id="imageName" placeholder="Image name (cycle1.jpg)">
      <button class="addBtn" id="addCycleBtn">Add Cycle</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Owner</th>
          <th>Price</th>
          <th>Campus</th>
          <th>Status</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody id="adminTable"></tbody>
    </table>
  </div>
</main>

<!-- ABOUT MODAL -->
<div id="aboutModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>About Me</h2>
    <p>
      Hi, I‚Äôm <b>Sai Tejeshwar Pawar</b>, a B.Tech student at <b>IIT Gandhinagar</b>.
      I built <b>Cycle Ride</b> to help students rent unused cycles on campus.
      <br><br>
      ‚ö†Ô∏è This is a <b>prototype</b>. No payments are integrated.
      Please <b>DO NOT MAKE ANY PAYMENT</b>.
    </p>
  </div>
</div>

<script type="module">
import { auth, db } from "./js/firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const ADMIN_EMAIL = "pawarsaitejeshwar07@gmail.com";
const GOOGLE_FORM =
"https://docs.google.com/forms/d/e/1FAIpQLSdEyg-0mXi84hS1M8xndimasqhz2DTRYQj8WmMbjHcB8ltk6Q/viewform";

const userName = document.getElementById("userName");
const logoutBtn = document.getElementById("logoutBtn");
const cycleList = document.getElementById("cycleList");
const adminPanel = document.getElementById("adminPanel");
const adminTable = document.getElementById("adminTable");

let currentUser;
let isAdmin=false;

onAuthStateChanged(auth,user=>{
  if(!user) location.href="index.html";
  currentUser=user;
  isAdmin=user.email===ADMIN_EMAIL;
  userName.innerText=`üëã ${user.displayName}`;
  adminPanel.style.display=isAdmin?"block":"none";
  loadCycles();
});

logoutBtn.onclick=()=>signOut(auth);

async function loadCycles(){
  cycleList.innerHTML="";
  adminTable.innerHTML="";
  const snap=await getDocs(collection(db,"cycles"));

  snap.forEach(d=>{
    const c=d.data();
    if(c.status==="available"){
      cycleList.innerHTML+=`
      <div class="card">
        <img src="${c.imageUrl}">
        <div class="info">
          <b>${c.ownerName}</b><br>
          ‚Çπ${c.price}/day<br>
          <span class="muted">${c.campus}</span>
        </div>
        <button class="rentBtn"
          onclick="openForm('${c.ownerName}',${c.price},'${c.campus}')">
          Rent
        </button>
      </div>`;
    }

    if(isAdmin){
      adminTable.innerHTML+=`
      <tr>
        <td>${c.ownerName}</td>
        <td>‚Çπ${c.price}</td>
        <td>${c.campus}</td>
        <td>${c.status}</td>
        <td><button class="deleteBtn" onclick="del('${d.id}')">Delete</button></td>
      </tr>`;
    }
  });
}

window.openForm=(owner,price,campus)=>{
  window.open(GOOGLE_FORM,"_blank");
};

window.del=async id=>{
  if(confirm("Delete cycle?")){
    await deleteDoc(doc(db,"cycles",id));
    loadCycles();
  }
};

addCycleBtn.onclick=async()=>{
  await addDoc(collection(db,"cycles"),{
    ownerName:ownerName.value,
    price:Number(price.value),
    campus:campus.value,
    imageUrl:`images/${imageName.value}`,
    status:"available"
  });
  ownerName.value=price.value=campus.value=imageName.value="";
  loadCycles();
};

/* MODAL */
const aboutBtn=document.getElementById("aboutBtn");
const aboutModal=document.getElementById("aboutModal");
const closeBtn=document.querySelector(".close");

aboutBtn.onclick=()=>aboutModal.style.display="block";
closeBtn.onclick=()=>aboutModal.style.display="none";
window.onclick=e=>{if(e.target===aboutModal)aboutModal.style.display="none";}
</script>

</body>
</html>
